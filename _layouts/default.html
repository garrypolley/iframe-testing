<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

  mermaid.initialize({
    startOnLoad: true,
    theme: 'default'
  });

  // Wait for the document to load
  document.addEventListener('DOMContentLoaded', function() {
    // Find all code elements with language-mermaid class
    const mermaidCodeBlocks = document.querySelectorAll('code.language-mermaid');

    mermaidCodeBlocks.forEach(codeBlock => {
      // Create a new div with mermaid class
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.innerHTML = codeBlock.textContent;

      // Replace the code block with the new div
      const preBlock = codeBlock.parentElement;
      preBlock.parentElement.replaceChild(mermaidDiv, preBlock);
    });

    // Re-run mermaid to render the new diagrams
    mermaid.init();
  });
</script>